name: Join domain
vars:
  # temp, workaround for https://github.com/ovh/venom/issues/445
  # pf only accepts hostname with less than 14 characters
  random_server_name: "{{ randAlpha 13 }}"
testcases:
- name: create_domain
  steps:
  - type: pf_api_domains_create
    ad_server: "{{.ad_mgmt_ip}}"
    bind_dn: null
    bind_pass: null
    dns_name: "{{.ad_dns_domain}}"
    dns_servers: "{{.ad_mgmt_ip}}"
    id: "{{.ad_domain_id}}"
    ntlm_cache: null
    ntlm_cache_expiry: 3600
    ntlm_cache_source: null
    ntlmv2_only: null
    ou: "Computers"
    registration: null
    server_name: "{{.random_server_name}}"
    status: "enabled"
    sticky_dc: "*"
    workgroup: "{{.ad_domain_upper}}"

- name: join_domain
  steps:
  - type: pf_api_domain_join
    id: "{{.ad_domain_id}}"
    username: "{{.ad_domain_admin_user}}@{{.ad_dns_domain}}"
    password: "{{.ad_domain_admin_password}}"
