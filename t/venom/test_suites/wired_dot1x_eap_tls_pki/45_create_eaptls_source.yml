name: Create EAP-TLS source
testcases:
#
# Need bug fixed before doing an executor
# https://github.com/ovh/venom/issues/493
# https://github.com/ovh/venom/issues/425
#
- name: create_eaptls_source
  steps:
  - type: pf_api_action
    method: POST
    url: 'config/sources'
    status_code: 201
    body: >-
      {
        "administration_rules": null,
        "authentication_rules": [
          {
            "id": "check_issuer",
            "description": null,
            "match": "all",
            "actions": [
              {
                "type": "set_role",
                "value": "{{.wired_dot1x_eap_tls_manual.roles.dot1x_eap_tls.id}}"
              },
              {
                "type": "set_access_duration",
                "value": "{{.wired_dot1x_eap_tls_manual.sources.eaptls.access_duration}}"
              }
            ],
            "conditions": [
              {
                "attribute": "radius_request.TLS-Client-Cert-Issuer",
                "operator": "equals",
                "value": "{{.wired_dot1x_eap_tls_manual.certs.ca.issuer}}"
              }
            ]
          }
        ],
        "description": "{{.wired_dot1x_eap_tls_manual.sources.eaptls.description}}",
        "id": "{{.wired_dot1x_eap_tls_manual.sources.eaptls.name}}",
        "realms": "",
        "set_access_durations_action": null,
        "type": "EAPTLS"
      }
