PKI Quick Installation Guide
============================
:encoding: UTF-8
:lang: en
:doctype: book

include::includes/global-attributes.asciidoc[]

About this Guide
----------------

This guide has been created to give a quick start to install the Inverse PKI in PacketFence 5+. This guide does not include advanced troubleshooting of EAP-TLS connection. Refer to the documentation of EAP-TLS, RADIUS and OpenSSL for advanced features.

Assumptions
-----------

* You have at least one server with PacketFence 5+
* The server already have a switch with an 802.1X connection working
* Packetfence RADIUS server is working in your environnement

Installation
------------

NOTE: For this guide, PF management IP is 192.168.1.5.

Step 1: Install the PKI
~~~~~~~~~~~~~~~~~~~~~~~

NOTE: Packetfence-PKI is available on the Packetfence repo as the package packetfence-pki. This is available for CentOS6/7 or Debian7/8.

Installing 
^^^^^^^^^^

First off you will need to install the package

Use the following command matching your OS.

Debian/Ubuntu:
 # sudo apt-get install packetfence-pki

CentOS/RHEL:
 # yum install packetfence-pki --enablerepo=packetfence

Step2: Configuring the PKI
~~~~~~~~~~~~~~~~~~~~~~~~~~

Inverse-PKI Configuration
^^^^^^^^^^^^^^^^^^^^^^^^^

NOTE: This following configuration will allow you to generate certificate for an EAP-TLS configuration, if you want to use the PKI for another purpose you will have to find the Key Usage/Extended Key Usage necessary.

Now that your PKI is installed, you need to configure it.

PKI Side
^^^^^^^^

You will first need to log into the PKI:

* Address: https://192.168.1.5:9191
* Login: admin
* Password: packetfence

After you logged in there is few steps to follow to have the PKI working for an EAP-TLS configuration with Packetfence. You will need to create the following items: 

* Certificate of Authority
* Profiles(for each purpose, ie Server/Client auth are 2 different profiles)
* Manual certificate generation

To help you out through the configuration, the first login will ask you to create a CA.

Certificate of Authority
^^^^^^^^^^^^^^^^^^^^^^^^
 
* Key type, size and digest: we advise to use the following RSA, 2048, sha1
* Key Usage and Extended Key Usage can be filled if necessary, more informations about Key Usage and Extended Key Usage here: rfc5280 part 4.2.1.3 and 4.2.1.12
* Days: Number of validity days, ie 3y = 1068

IMPORTANT: Remember to not but a too early validity on your CA, since if it is expire all of the certificate generate by this CA won't be valid anymore.

Profile
^^^^^^^

Creation of a profile:

* Login: admin
* Password: packetfence
* Crl path: Certification revokation list path, a file will be created when you fill this.
* Validity: Number of validity days, ie 3y = 1068
* Key type, size and digest: we advise to use the following RSA, 2048, sha1
* Key Usage: Empty 
* Extended Key Usage: Server Certificate Authentication: TLS Web Server Authentication, Client Authentication: TLS Web Client Authentication, more informations about Key Usage and Extended Key Usage here: rfc5280 part 4.2.1.3 and 4.2.1.12
* The P12 mail setup is not mandatory but advise if you need to manually send certificate by email. This will format the mail send with your certificate. 

RADIUS server auth cert
^^^^^^^^^^^^^^^^^^^^^^^

Generate a certificate from the profile you defined as the server authentication Profile. This certificate will need to be installed and setup as the certificate for authenticate RADIUS. Also it will be necessary to install and trust the CA on Packetfence.

Client auth cert
^^^^^^^^^^^^^^^^

Generate a certificate from the profile you defined as the client authentication Profile, if you generate this certificate manually you will need to use the 'download certificate' or 'send certificate' button. When the certificate is generate via Packetfence, the certificate is automatically integrate into the profile to setup the WiFi network.

Revokation process
^^^^^^^^^^^^^^^^^^

We have two way to check if a certificate is revoke, you can either use OCSP to interegote the PKI if the certificate is still valid, or use the revokation lists(CRL). However since the OCSP is implemented we advise you to use this method.
OSCP is scalable, his cons would be that we have to send 1 request by certificate to verify that this certificate is still valid.
With the CRL everytime the CRL is update the router/server has to download again the CRL. 

Packetfence Side
^^^^^^^^^^^^^^^^

packetfence-pki
^^^^^^^^^^^^^^^

To work with our PKI in packetfence you will need to addi the PKI in the PKI_Provider section.

Click on add a new PKI and select packetfence-pki.

Follow the instructions below to fill the packetfence-pki configuration.

image::docs/images/Screenshot packetfence-pki 1/2[scaledwidth="100%",alt="SSID creation"]
image::docs/images/Screenshot packetfence-pki 2/2[scaledwidth="100%",alt="SSID creation"]

Additionnal informations
------------------------

If you need any additional information for the certificate generation we advise to go here: rfc 5280
