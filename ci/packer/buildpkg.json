{
    "description": "Images used in CI to build packetfence packages",
    "min_packer_version": "1.4.2",
    "variables": {
        "GOPFDIR": "/root/go/src/github.com/inverse-inc/packetfence"
    },
    "builders": [
        {
            "name": "buildpkg-centos",
            "type": "docker",
            "image": "buildpkg/centos:7",
            "commit": true
        },
        {
            "name": "buildpkg-debian",
            "type": "docker",
            "image": "buildpkg/debian:stretch",
            "commit": true
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "script": "../../addons/dev-helpers/setup-go-env.sh",
            "environment_vars": ["GOPATH=$HOME/go"]

        },
        {
            "type": "file",
            "source": "../../go",
            "destination": "{{user `GOPFDIR`}}"
        },
        {
            "type": "shell",
            "script": "shell/install-go-dependencies.sh"
        }
    ],
    "post-processors": [
        {
            "type": "docker-tag",
            "only": ["buildpkg-centos"],
            "repository": "inverse-inc/buildpkg-pf",
            "tag": "centos"
        },
        {
            "type": "docker-tag",
            "only": ["buildpkg-debian"],
            "repository": "inverse-inc/buildpkg-pf",
            "tag": "debian"
        }
    ]
}
