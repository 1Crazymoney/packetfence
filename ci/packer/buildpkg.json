{
    "description": "Images used in CI to build packetfence packages",
    "min_packer_version": "1.4.2",
    "variables": {
        "go_version": "go1.9.3",
        "go_path": "/root/go",
        "go_pf_workspace": "src/github.com/inverse-inc/packetfence"
    },
    "builders": [
        {
            "name": "pfbuild-centos7",
            "type": "docker",
            "image": "buildpkg/centos:7",
            "commit": true,
            "changes": [
                "ENTRYPOINT /bin/bash"
            ]
        },
        {
            "name": "pfbuild-stretch",
            "type": "docker",
            "image": "buildpkg/debian:stretch",
            "commit": true,
            "changes": [
                "ENTRYPOINT /bin/bash"
            ]
        },
        {
            "name": "pfbuild-buster",
            "type": "docker",
            "image": "buildpkg/debian:buster",
            "commit": true,
            "changes": [
                "ENTRYPOINT /bin/bash"
            ]
        },
    ],
    "provisioners": [
        {
            "type": "shell",
            "script": "../../addons/dev-helpers/setup-go-env.sh",
            "environment_vars": ["GOVERSION={{user `go_version`}}",
                                 "GOPATH={{user `go_path`}}",
                                 "GO_PF_WORKSPACE={{user `go_pf_workspace`}}"
                                ]

        },
        {
            "type": "file",
            "source": "../../go",
            "destination": "{{user `go_path`}}/{{user `go_pf_workspace`}}"
        },
        {
            "type": "shell",
            "script": "provisionners/install-go-dependencies.sh",
            "environment_vars": ["GOPATH={{user `go_path`}}",
                                 "GO_APP_WORKSPACE={{user `go_pf_workspace`}}"
                                ]
        }
    ],
    "post-processors": [
        {
            "type": "docker-tag",
            "only": ["pfbuild-centos7"],
            "repository": "inverse-inc/pfbuild-centos",
            "tag": "7"
        },
        {
            "type": "docker-tag",
            "only": ["pfbuild-stretch"],
            "repository": "inverse-inc/pfbuild-debian",
            "tag": "stretch"
        }
        {
            "type": "docker-tag",
            "only": ["pfbuild-buster"],
            "repository": "inverse-inc/pfbuild-debian",
            "tag": "buster"
        }
    ]
}
